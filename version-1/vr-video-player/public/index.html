<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, maximum-scale=1" />
  <title>VR Video Experience</title>
  <link rel="icon" type="image/x-icon" href="./favicon.ico" />
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet" />
  <style>
    /* --- BODY & BASE STYLES --- */
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background: #000;
      color: #fff;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
      position: fixed;
    }

    /* --- INITIAL UI (2D VIDEO PREVIEW) --- */
    .initialUI {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 1000;
      padding: 20px;
      background: rgba(34, 34, 34, 0.95);
      border-radius: 15px;
      backdrop-filter: blur(10px);
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
      max-width: 90%;
      width: 400px;
    }
    .initialUI h1 {
      font-size: 1.5em;
      margin-bottom: 15px;
    }
    .initialUI video {
      width: 100%;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      margin-bottom: 20px;
    }
    .initialUI button {
      background: linear-gradient(45deg, #6b48ff, #00ddeb);
      padding: 12px 30px;
      border: none;
      border-radius: 25px;
      font-size: 1.2em;
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
      box-shadow: 0 5px 15px rgba(107, 72, 255, 0.4);
      width: 100%;
      max-width: 200px;
    }
    .initialUI button:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 20px rgba(107, 72, 255, 0.6);
    }

    /* --- LOADING INDICATOR --- */
    .loading-indicator {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 2000;
    }
    .loading-indicator.visible {
      display: flex;
    }
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255, 255, 255, 0.2);
      border-top: 4px solid #6b48ff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }
    .loading-text {
      margin-top: 20px;
      font-size: 1.2em;
      color: #fff;
    }

    /* --- VR INTERFACE CONTAINER --- */
    .vr-interface {
      position: fixed;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
    }
    .vr-interface.visible {
      pointer-events: auto;
    }

    /* --- VR CONTROLS PANEL --- */
    .vr-controls-panel {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, rgba(34, 34, 34, 0.95), rgba(20, 20, 20, 0.95));
      padding: 15px 25px;
      border-radius: 30px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      flex-direction: column;
      gap: 15px;
      opacity: 0;
      transition: opacity 0.3s ease;
      max-width: 90vw;
      pointer-events: auto;
    }
    .vr-controls-panel.visible {
      opacity: 1;
    }

    .video-title {
      color: #fff;
      font-size: 1.1em;
      text-align: center;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      user-select: none;
    }

    .controls-row {
      display: flex;
      align-items: center;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .vr-button {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: linear-gradient(45deg, #6b48ff, #00ddeb);
      border: none;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(107, 72, 255, 0.3);
      user-select: none;
    }
    .vr-button:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(107, 72, 255, 0.5);
    }

    .vr-progress-container {
      width: 300px;
      position: relative;
      user-select: none;
    }
    .vr-progress-bar {
      width: 100%;
      height: 6px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    .vr-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #6b48ff, #00ddeb);
      border-radius: 3px;
      width: 0;
      transition: width 0.1s linear;
      box-shadow: 0 0 10px rgba(107, 72, 255, 0.5);
    }
    .time-display {
      color: #fff;
      font-size: 0.9em;
      text-align: center;
      margin-top: 5px;
      opacity: 0.9;
      user-select: none;
    }

    .volume-container {
      display: flex;
      align-items: center;
      gap: 10px;
      user-select: none;
    }
    .volume-slider {
      width: 100px;
      height: 6px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
      cursor: pointer;
      position: relative;
    }
    .volume-fill {
      height: 100%;
      background: linear-gradient(90deg, #6b48ff, #00ddeb);
      border-radius: 3px;
      width: 100%;
    }

    /* --- TOP CONTROLS (EXIT & FULLSCREEN) --- */
    .top-controls {
      position: fixed;
      top: 20px;
      left: 20px;
      right: 20px;
      display: flex;
      justify-content: space-between;
      pointer-events: auto;
      user-select: none;
    }
    .top-button {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(45deg, #6b48ff, #00ddeb);
      border: none;
      color: #fff;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(107, 72, 255, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    .top-button:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(107, 72, 255, 0.5);
    }

    /* --- HIDE A-FRAME CONTROLS (optional) --- */
    a-scene {
      width: 100%;
      height: 100vh;
      display: none;
      z-index: 5000;
      background: black;
    }
    a-scene.visible {
      display: block;
    }

  </style>
</head>
<body>

  <!-- INITIAL UI with preview video -->
  <div class="initialUI">
    <h1>360Â° VR Video Preview</h1>
    <video id="preview" src="https://storage.googleapis.com/vrvideo1/video1/VR%20360%20The%20Beast%20World's%20Longest%20Wooden%20Roller%20Coaster%20POV%20Kings%20Island%20Ohio.mp4" loop muted playsinline></video>
    <button id="enterVRBtn">Enter VR</button>
  </div>

  <!-- Loading Indicator -->
  <div class="loading-indicator" id="loadingIndicator">
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading VR Experience...</div>
  </div>

  <!-- A-Frame VR Scene -->
  <a-scene id="vrScene" embedded vr-mode-ui="enabled: false" renderer="colorManagement: true; foveationLevel: 0;" class="">
    <a-assets>
      <video id="vrVideo" autoplay loop muted crossorigin="anonymous" playsinline webkit-playsinline preload="auto" src="https://storage.googleapis.com/vrvideo1/video1/VR%20360%20The%20Beast%20World's%20Longest%20Wooden%20Roller%20Coaster%20POV%20Kings%20Island%20Ohio.mp4"></video>
    </a-assets>

    <!-- 360 Video Sphere -->
    <a-videosphere src="#vrVideo" rotation="0 -90 0"></a-videosphere>

    <!-- Camera with look-controls -->
    <a-entity id="camera" camera look-controls wasd-controls position="0 1.6 0"></a-entity>
  </a-scene>

  <!-- VR Interface Overlay -->
  <div class="vr-interface" id="vrInterface">
    <div class="top-controls">
      <button class="top-button" id="exitBtn" title="Exit VR">
        <span class="material-icons-round">close</span>
      </button>
      <button class="top-button" id="fullscreenBtn" title="Toggle Fullscreen">
        <span class="material-icons-round">fullscreen</span>
      </button>
    </div>

    <!-- VR Controls Panel -->
    <div class="vr-controls-panel" id="vrControlsPanel" aria-label="VR Video Controls" role="region">
      <div class="video-title" id="videoTitle">The Beast - Kings Island POV</div>
      <div class="controls-row">
        <button class="vr-button" id="playPauseBtn" title="Play/Pause Video" aria-pressed="false">
          <span class="material-icons-round" id="playPauseIcon">play_arrow</span>
        </button>

        <div class="vr-progress-container" title="Seek Video">
          <div class="vr-progress-bar" id="progressBar" role="slider" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" tabindex="0">
            <div class="vr-progress-fill" id="progressFill"></div>
          </div>
          <div class="time-display" id="timeDisplay">0:00 / 0:00</div>
        </div>

        <div class="volume-container" title="Volume Controls">
          <button class="vr-button" id="muteBtn" title="Mute/Unmute Video" aria-pressed="false">
            <span class="material-icons-round" id="muteIcon">volume_up</span>
          </button>
          <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1" aria-label="Volume slider" />
        </div>
      </div>
    </div>
  </div>

  <script>
    // DOM references
    const initialUI = document.querySelector('.initialUI');
    const loadingIndicator = document.getElementById('loadingIndicator');
    const vrScene = document.getElementById('vrScene');
    const vrInterface = document.getElementById('vrInterface');
    const vrControlsPanel = document.getElementById('vrControlsPanel');
    const vrVideo = document.getElementById('vrVideo');
    const previewVideo = document.getElementById('preview');

    const enterVRBtn = document.getElementById('enterVRBtn');
    const exitBtn = document.getElementById('exitBtn');
    const fullscreenBtn = document.getElementById('fullscreenBtn');

    const playPauseBtn = document.getElementById('playPauseBtn');
    const playPauseIcon = document.getElementById('playPauseIcon');
    const progressBar = document.getElementById('progressBar');
    const progressFill = document.getElementById('progressFill');
    const timeDisplay = document.getElementById('timeDisplay');
    const muteBtn = document.getElementById('muteBtn');
    const muteIcon = document.getElementById('muteIcon');
    const volumeSlider = document.getElementById('volumeSlider');

    // Helper functions
    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    function updateTimeDisplay() {
      if (!vrVideo.duration || isNaN(vrVideo.duration)) {
        timeDisplay.textContent = `0:00 / 0:00`;
        return;
      }
      timeDisplay.textContent = `${formatTime(vrVideo.currentTime)} / ${formatTime(vrVideo.duration)}`;
    }

    function updatePlayPauseIcon() {
      if (vrVideo.paused) {
        playPauseIcon.textContent = 'play_arrow';
        playPauseBtn.setAttribute('aria-pressed', 'false');
      } else {
        playPauseIcon.textContent = 'pause';
        playPauseBtn.setAttribute('aria-pressed', 'true');
      }
    }

    function updateVolumeUI() {
      if (vrVideo.muted || vrVideo.volume === 0) {
        muteIcon.textContent = 'volume_off';
        muteBtn.setAttribute('aria-pressed', 'true');
        volumeSlider.value = 0;
      } else if (vrVideo.volume < 0.5) {
        muteIcon.textContent = 'volume_down';
        muteBtn.setAttribute('aria-pressed', 'false');
        volumeSlider.value = vrVideo.volume;
      } else {
        muteIcon.textContent = 'volume_up';
        muteBtn.setAttribute('aria-pressed', 'false');
        volumeSlider.value = vrVideo.volume;
      }
    }

    // Enter VR button click handler
    enterVRBtn.addEventListener('click', () => {
      initialUI.style.display = 'none';
      loadingIndicator.classList.add('visible');

      // Sync video currentTime from preview if needed
      vrVideo.currentTime = previewVideo.currentTime || 0;

      vrVideo.load();
      vrVideo.play().then(() => {
        loadingIndicator.classList.remove('visible');
        vrScene.classList.add('visible');
        vrInterface.classList.add('visible');
        vrControlsPanel.classList.add('visible');
        updatePlayPauseIcon();
        updateVolumeUI();
        updateTimeDisplay();
      }).catch(err => {
        alert("Failed to start VR video: " + err.message);
        initialUI.style.display = 'block';
        loadingIndicator.classList.remove('visible');
      });
    });

    // Exit VR button click handler
    exitBtn.addEventListener('click', () => {
      vrVideo.pause();
      vrScene.classList.remove('visible');
      vrInterface.classList.remove('visible');
      vrControlsPanel.classList.remove('visible');
      initialUI.style.display = 'block';
    });

    // Play/pause toggle
    playPauseBtn.addEventListener('click', () => {
      if (vrVideo.paused) {
        vrVideo.play();
      } else {
        vrVideo.pause();
      }
      updatePlayPauseIcon();
    });

    // Update play/pause icon on play/pause events
    vrVideo.addEventListener('play', updatePlayPauseIcon);
    vrVideo.addEventListener('pause', updatePlayPauseIcon);

    // Update progress bar on video time update
    vrVideo.addEventListener('timeupdate', () => {
      if (!vrVideo.duration || isNaN(vrVideo.duration)) return;
      const progressPercent = (vrVideo.currentTime / vrVideo.duration) * 100;
      progressFill.style.width = progressPercent + '%';
      progressBar.setAttribute('aria-valuenow', progressPercent.toFixed(0));
      updateTimeDisplay();
    });

    // Seek video on progress bar click
    progressBar.addEventListener('click', (e) => {
      const rect = progressBar.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const newTime = (clickX / rect.width) * vrVideo.duration;
      vrVideo.currentTime = newTime;
    });

    // Volume controls
    muteBtn.addEventListener('click', () => {
      vrVideo.muted = !vrVideo.muted;
      updateVolumeUI();
    });

    volumeSlider.addEventListener('input', () => {
      vrVideo.volume = volumeSlider.value;
      vrVideo.muted = volumeSlider.value == 0;
      updateVolumeUI();
    });

    // Fullscreen toggle
    fullscreenBtn.addEventListener('click', () => {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        }
      }
    });
  </script>

</body>
</html>
